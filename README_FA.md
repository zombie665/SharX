# SharX

[English](README_EN.md) | [Русский](README_RU.md) | [فارسی](README_FA.md)

## به SharX خوش آمدید

**شار ایکس (SharX)** یک فورک (انشعاب) از پنل اصلی **3XUI** با قابلیت‌های ارتقا یافته و امکانات نظارتی است.

این نسخه بهبودهای قابل توجهی را به همراه دارد، از جمله معماری مدرن، فرآیند نصب ساده‌سازی شده با استفاده از کانتینرهای داکر، و **ادغام Grafana** برای نظارت پیشرفته با Prometheus و Loki.

## چه چیزی جدید است

### حالت نود (۱ پنل – چندین نود)

* **مدیریت متمرکز**: یک پنل اکنون می‌تواند چندین نود را مدیریت کند.
* **حالت ثبت‌نام**: در اولین اجرا، نودها در حالت ثبت‌نام اجرا می‌شوند و منتظر اتصال از سمت پنل می‌مانند.
* **احراز هویت امن**: پنل یک توکن API صادر می‌کند، نود را امضا می‌کند و آن را برای استفاده‌های بعدی ذخیره می‌کند.
* **معماری مقیاس‌پذیر**: با رشد زیرساخت خود، به راحتی نودها را اضافه یا حذف کنید.

### جداسازی موجودیت‌های کلاینت و اینباند (Inbound)

* **تخصیص انعطاف‌پذیر کلاینت**: یک کلاینت اکنون می‌تواند به چندین اینباند اختصاص داده شود.
* **اشتراک‌های چند-اینباندی**: تمام اینباندهای اختصاص داده شده در لینک اشتراک نمایش داده می‌شوند.
* **انعطاف‌پذیری نود**: چندین نود می‌توانند به یک اینباند واحد اختصاص داده شوند.
* **مدیریت منابع بهتر**: استفاده کارآمدتر از منابع سرور.

### تب هاست‌ها (Hosts)

* **بازنویسی آدرس**: آدرس نودها را در اشتراک‌ها بازنویسی (Override) کنید.
* **پشتیبانی از پروکسی**: ایده‌آل برای نودهایی که پشت یک پروکسی یا لود بالانسر پنهان شده‌اند.
* **مسیریابی انعطاف‌پذیر**: پیکربندی آدرس‌های هاست متفاوت برای موارد استفاده مختلف.

### ادغام Redis

* **افزایش عملکرد**: زمان پاسخگویی رابط کاربری به طور قابل توجهی سریع‌تر شده است.
* **کش هوشمند**: کوئری‌های پر تکرار دیتابیس را کش می‌کند.
* **ارائه کارآمد داده‌ها**: اگر پارامترهای درخواست تغییر نکرده باشند و کش معتبر باشد، داده‌ها مستقیماً از Redis ارائه می‌شوند.
* **کاهش بار دیتابیس**: فشار کمتر بر روی دیتابیس PostgreSQL.

### مهاجرت کامل به PostgreSQL

* **دیتابیس قابل اعتماد**: مهاجرت کامل از SQLite به PostgreSQL.
* **بروزرسانی وارد کردن/خروجی گرفتن**: بخش پشتیبان‌گیری (Backup) برای PostgreSQL بروزرسانی شده است.
* **ابزار مهاجرت**: ابزار داخلی برای مهاجرت از SQLite به PostgreSQL که از کاربران فعلی پشتیبانی می‌کند.
* **یکپارچگی داده‌ها**: انتقال کامل و مطمئن داده‌ها در طول فرآیند مهاجرت.

### ادغام Grafana

* **متریک‌های Prometheus**: جمع‌آوری و نظارت لحظه‌ای متریک‌ها.
* **لاگ‌های Loki**: تجمیع و تحلیل متمرکز لاگ‌ها.
* **نظارت پیشرفته**: داشبوردهای جامع برای عملکرد سیستم.
* **هشدارها (Alerting)**: هشدارها قابل پیکربندی بر اساس متریک‌ها و لاگ‌ها.

### مدل توزیع جدید

* **مبتنی بر داکر**: ایمیج‌های داکر از پیش ساخته شده برای استقرار آسان.
* **چند پلتفرمی**: قابل اجرا بر روی هر سیستم‌عامل و معماری CPU.
* **نصب سریع**: دانلود ایمیج‌های آماده در ۵ تا ۱۰ ثانیه.
* **بدون نیاز به کامپایل**: نیازی به کامپایل کد در سرورهای ضعیف نیست.
* **مهاجرت آسان**: مهاجرت و مقیاس‌دهی ساده مبتنی بر کانتینر.

### شناسه سخت‌افزاری دستگاه (نسخه بتا) - Device HWID

* **شناسایی سخت‌افزاری**: شناسایی دستگاه توسط شناسه سخت‌افزاری منحصر‌به‌فرد برای امنیت بیشتر.
* **محافظت از کلاینت**: محافظت در برابر دسترسی غیرمجاز و نشت اشتراک.
* **کنترل دستگاه**: محدود و نظارت کردن دستگاه‌هایی که می‌توانند از اشتراک یک کلاینت استفاده کنند.
* **پیکربندی انفرادی**: به صورت پیش‌فرض غیرفعال است و می‌تواند برای هر کلاینت به صورت جداگانه فعال شود.
* **پشتیبانی کلاینت**: در حال حاضر در کلاینت‌های Happ و V2RayTun پشتیبانی می‌شود.
* **جلوگیری از نشت**: اگر یک اشتراک نشت کند (لو برود)، فقط دستگاه‌های ثبت شده می‌توانند به آن دسترسی داشته باشند.
* **نظارت بر استفاده**: ردیابی اینکه کدام دستگاه‌ها از هر اکانت استفاده می‌کنند.
* **امنیت انعطاف‌پذیر**: فعال‌سازی محافظت HWID فقط برای کلاینت‌هایی که به آن نیاز دارند.

## نصب

### پیش‌نیازها

* سرور لینوکس (Ubuntu, Debian, CentOS, Fedora, Arch, Alpine, openSUSE)
* دسترسی روت (Root)
* پورت‌های آزاد: 2053 (رابط کاربری وب)، 2096 (اشتراک‌ها)، 80 (برای گواهی SSL)

---

## گزینه ۱: نصب خودکار (پیشنهادی)

### نصب با یک خط دستور

```bash
bash <(curl -Ls https://raw.githubusercontent.com/konstpic/3x-ui-new/main/install.sh)
```

یا کلون کنید و اجرا نمایید:

```bash
git clone https://github.com/konstpic/3x-ui-new.git
cd 3x-ui-new
sudo bash install.sh
```

### اسکریپت چه کاری انجام می‌دهد

اسکریپت نصب به طور خودکار:

* توزیع لینوکس شما را تشخیص می‌دهد.
* داکر (Docker) و داکر کامپوز (Docker Compose) را نصب می‌کند.
* حالت شبکه را پیکربندی می‌کند (host یا bridge با نگاشت پورت).
* گواهی‌های SSL را از طریق Let's Encrypt (acme.sh) راه‌اندازی می‌کند.
* برای دامنه‌ها: گواهی‌های ۹۰ روزه با تمدید خودکار.
* برای آدرس‌های IP: گواهی‌های ۶ روزه با تمدید خودکار.


* رمز عبور امن برای دیتابیس تولید می‌کند.
* تمام سرویس‌ها را ایجاد و راه‌اندازی می‌کند.

### سیستم‌های پشتیبانی شده

| توزیع (Distribution) | مدیریت بسته (Package Manager) |
| --- | --- |
| Ubuntu/Debian | apt |
| Fedora | dnf |
| CentOS/RHEL | yum |
| Arch Linux | pacman |
| Alpine | apk |
| openSUSE | zypper |

### نصب پنل از طریق اسکریپت

```bash
sudo bash install.sh
```

گزینه **1) Install Panel** را انتخاب کنید و دستورالعمل‌ها را دنبال کنید:

1. حالت شبکه را انتخاب کنید (host/bridge).
2. پورت‌ها را برای پنل و اشتراک‌ها تنظیم کنید.
3. رمز عبور دیتابیس را تولید یا وارد کنید.
4. نوع گواهی SSL را انتخاب کنید (domain/IP/skip).

### نصب نود از طریق اسکریپت

```bash
sudo bash install.sh
```

گزینه **2) Install Node** را انتخاب کنید و دستورالعمل‌ها را دنبال کنید:

1. حالت شبکه را انتخاب کنید (host/bridge).
2. پورت API را تنظیم کنید.
3. نوع گواهی SSL را انتخاب کنید.

### منوی مدیریت

پس از نصب، اسکریپت را دوباره اجرا کنید تا به منوی مدیریت دسترسی پیدا کنید:

```bash
sudo bash install.sh
```

**گزینه‌های موجود:**

* **Panel**: نصب، بروزرسانی، شروع، توقف، ریستارت، وضعیت، لاگ‌ها.
* **Panel Settings**: تغییر پورت‌ها، تغییر رمز دیتابیس، تمدید/راه‌اندازی گواهی‌ها.
* **Node**: نصب، بروزرسانی، شروع، توقف، ریستارت، وضعیت، لاگ‌ها، تمدید گواهی‌ها.
* **Uninstall**: حذف نصب.

### بروزرسانی پنل/نود

```bash
sudo bash install.sh
# انتخاب کنید: 2) Update Panel یا 21) Update Node
```

فرآیند بروزرسانی:

1. ایمیج جدید داکر را دریافت می‌کند (در حالی که سرویس در حال اجراست).
2. کانتینر قدیمی را متوقف و حذف می‌کند.
3. کانتینر جدید را با ایمیج بروزرسانی شده شروع می‌کند.
4. دیتابیس ریستارت نمی‌شود (بدون از دست رفتن داده‌ها).

---

## گزینه ۲: نصب دستی

### نصب پنل

1. **کلون یا دانلود این مخزن**
```bash
git clone https://github.com/konstpic/3x-ui-new.git
cd 3x-ui-new
```


2. **پیکربندی Docker Compose**
فایل `docker-compose.yml` را ویرایش کرده و تنظیمات زیر را بروزرسانی کنید:
**پیکربندی دیتابیس:**
* عبارت `change_this_password` را به یک رمز عبور امن در هر دو متغیر `XUI_DB_PASSWORD` و `POSTGRES_PASSWORD` تغییر دهید.
* این رمز عبورها باید یکسان باشند تا پنل بتواند به PostgreSQL متصل شود.
* مثال:
```yaml
XUI_DB_PASSWORD: your_secure_password_here
POSTGRES_PASSWORD: your_secure_password_here
```




**پیکربندی پورت:**
* پورت‌های پیش‌فرض: 2053 (Web UI)، 2096 (Subscriptions)، 5432 (PostgreSQL).
* در صورت نیاز نگاشت پورت‌ها را تنظیم کنید:
```yaml
ports:
  - "2053:2053"   # Web UI
  - "2096:2096"   # Subscriptions
  - "5432:5432"   # PostgreSQL (اختیاری، برای دسترسی خارجی)

```




**نام هاست (اختیاری):**
* اگر می‌خواهید نام هاست (Hostname) برای کانتینر مشخص کنید، `hostname` را از کامنت خارج کرده و تنظیم کنید:
```yaml
hostname: yourhostname
```




**حالت شبکه (اختیاری):**
* برای عملکرد بهتر، می‌توانید از حالت شبکه host استفاده کنید.
* `network_mode: host` را از حالت کامنت خارج کنید:
```yaml
network_mode: host
```


* هنگام استفاده از حالت host، بخش `ports` را حذف کنید زیرا پورت‌ها مستقیماً روی هاست در دسترس خواهند بود.


3. **آماده‌سازی گواهی‌های SSL برای TLS**
**مهم**: برای اتصال TLS/HTTPS، شما نیاز دارید به:
* یک نام دامنه که به سرور شما اشاره کند.
* گواهی‌های SSL (فایل گواهی و کلید خصوصی).


**مرحله ۱: ایجاد دایرکتوری گواهی**
```bash
mkdir -p cert
```


**مرحله ۲: کپی کردن گواهی‌های SSL شما**
فایل‌های گواهی SSL خود را به دایرکتوری `cert` کپی کنید. شما نیاز دارید به:
* فایل گواهی (معمولاً `cert.pem` یا `fullchain.pem`).
* فایل کلید خصوصی (معمولاً `privkey.pem` یا `key.pem`).


مثال:
```bash
# کپی کردن فایل گواهی
cp /path/to/your/certificate.pem cert/cert.pem

# کپی کردن فایل کلید خصوصی
cp /path/to/your/private.key cert/privkey.pem
```


**نکته**: گواهی‌ها در مسیر `/root/cert/` داخل کانتینر مانت (mount) می‌شوند، اما در تنظیمات پنل باید از مسیرهای `/app/cert/` استفاده کنید.
**الزامات گواهی:**
* فایل گواهی باید با نام `cert.pem` باشد.
* فایل کلید خصوصی باید با نام `privkey.pem` باشد.
* هر دو فایل باید در دایرکتوری `cert/` باشند.
* از مجوزهای دسترسی صحیح فایل (قابل خواندن توسط کانتینر) اطمینان حاصل کنید.


4. **شروع سرویس‌ها**
```bash
docker-compose up -d
```


5. **دسترسی به رابط کاربری وب (Web UI)**
مرورگر خود را باز کنید و به آدرس زیر بروید:
```
http://your-server-ip:2053
```


یا اگر از HTTPS استفاده می‌کنید:
```
https://your-server-ip:2053
```


6. **راه‌اندازی اولیه**
* ویزارد راه‌اندازی اولیه را تکمیل کنید.
* اکانت ادمین خود را تنظیم کنید.
* اولین اتصال نود خود را پیکربندی کنید.


7. **پیکربندی TLS در تنظیمات پنل**
پس از دسترسی به پنل، TLS را برای اتصالات امن پیکربندی کنید:
**در تنظیمات پنل (Panel Settings):**
* به مسیر Settings/Configuration بروید.
* **Domain Name**: نام دامنه خود را وارد کنید (مثلاً `panel.example.com`).
* این باید همان نام دامنه‌ای باشد که به سرور شما اشاره دارد.
* دامنه باید دارای رکوردهای DNS معتبر باشد که به IP سرور شما اشاره می‌کنند.




**مسیرهای گواهی (Certificate Paths):**
* **Certificate Path**: `/app/cert/cert.pem`
* این مسیری در داخل کانتینر است که فایل گواهی شما در آنجا قرار دارد.
* فایل `cert.pem` باید در دایرکتوری `cert/` روی هاست شما باشد.


* **Private Key Path**: `/app/cert/privkey.pem`
* این مسیری در داخل کانتینر است که فایل کلید خصوصی شما در آنجا قرار دارد.
* فایل `privkey.pem` باید در دایرکتوری `cert/` روی هاست شما باشد.




**نکات مهم:**
* مسیرهای `/app/cert/` مسیرهای داخلی کانتینر هستند.
* فایل‌های واقعی شما در دایرکتوری `cert/` روی هاست قرار دارند.
* داکر کامپوز مسیر `$PWD/cert/` را به `/root/cert/` در کانتینر مانت می‌کند.
* پنل از مسیرهای `/app/cert/` استفاده می‌کند که باید به گواهی‌های مانت شده شما نگاشت شود.
* اطمینان حاصل کنید که هر دو فایل `cert.pem` و `privkey.pem` در دایرکتوری `cert/` شما وجود دارند.


**تایید پیکربندی TLS:**
* پس از ذخیره تنظیمات، کانتینر را ریستارت کنید:
```bash
docker-compose restart 3xui
```


* از طریق HTTPS به پنل دسترسی پیدا کنید: `https://your-domain.com:2053`
* بررسی کنید که مرورگر یک گواهی SSL معتبر را نشان می‌دهد.



### نصب نود

1. **به دایرکتوری نود بروید**
```bash
cd node
```


2. **پیکربندی نود**
فایل `docker-compose.yml` را ویرایش و پیکربندی کنید:
* **Ports**: پورت‌های مناسب را برای نود خود تنظیم کنید.
* **Network Mode**: بین حالت شبکه bridge یا host انتخاب کنید.
* **Configuration**: در صورت نیاز `bin/config.json` را تنظیم کنید.


**گواهی‌های SSL برای نود (پیشنهادی):**
* دایرکتوری `cert` را در پوشه node ایجاد کنید:
```bash
mkdir -p cert
```


* گواهی‌های SSL خود را کپی کنید:
* **Certificate file**: فایل `fullchain.pem` (پیشنهادی برای نودها).
* **Private key file**: فایل `privkey.pem`.


```bash
cp /path/to/fullchain.pem cert/fullchain.pem
cp /path/to/privkey.pem cert/privkey.pem
```


* گواهی‌ها به `/app/cert/` داخل کانتینر مانت خواهند شد.
* متغیرهای محیطی در `docker-compose.yml` باید اشاره کنند به:
* `NODE_TLS_CERT_FILE=/app/cert/fullchain.pem`
* `NODE_TLS_KEY_FILE=/app/cert/privkey.pem`




3. **شروع نود**
```bash
docker-compose up -d
```


4. **اتصال به پنل**
* نود در حالت ثبت‌نام شروع به کار می‌کند.
* در پنل، یک نود جدید اضافه کنید.
* پنل یک توکن API صادر کرده و به نود متصل می‌شود.
* نود امضا شده و برای استفاده‌های بعدی ذخیره می‌شود.



### پیکربندی پیشرفته

#### استفاده از حالت شبکه Host

اگر می‌خواهید از شبکه host استفاده کنید (برای عملکرد بهتر پیشنهاد می‌شود)، خط `network_mode: host` را در `docker-compose.yml` از حالت کامنت خارج کنید:

```yaml
network_mode: host
```

هنگام استفاده از حالت host، بخش `ports` را حذف کنید زیرا پورت‌ها مستقیماً روی هاست در دسترس خواهند بود.

#### پیکربندی PostgreSQL

پیکربندی پیش‌فرض PostgreSQL استفاده می‌کند از:

* **کاربر**: `xui_user`
* **دیتابیس**: `xui_db`
* **پورت**: `5432` (در صورت نیاز برای دسترسی خارجی باز است)

برای تغییر این تنظیمات، متغیرهای محیطی را در `docker-compose.yml` بروزرسانی کنید.

#### پیکربندی Redis

Redis به طور خودکار پیکربندی و ادغام شده است. نیاز به تنظیمات اضافی نیست.

#### پیکربندی متغیرهای محیطی

SharX از پیکربندی جامع از طریق متغیرهای محیطی پشتیبانی می‌کند. این تنظیمات **فقط از طریق متغیرهای محیطی در دسترس هستند** و نمی‌توانند از طریق رابط کاربری وب تغییر کنند.

**تنظیمات پنل وب:**

| متغیر | توضیحات | پیش‌فرض | مثال |
| --- | --- | --- | --- |
| `XUI_WEB_PORT` | پورت پنل وب | `2053` | `2053` |
| `XUI_WEB_LISTEN` | آدرس IP برای گوش دادن | - | `0.0.0.0` |
| `XUI_WEB_DOMAIN` | دامنه پنل وب | - | `panel.example.com` |
| `XUI_WEB_BASE_PATH` | مسیر پایه URL | `/` | `/` |
| `XUI_WEB_CERT_FILE` | مسیر گواهی SSL | - | `/app/cert/fullchain.pem` |
| `XUI_WEB_KEY_FILE` | مسیر کلید خصوصی SSL | - | `/app/cert/privkey.pem` |

**تنظیمات سرویس اشتراک:**

| متغیر | توضیحات | پیش‌فرض | مثال |
| --- | --- | --- | --- |
| `XUI_SUB_PORT` | پورت سرویس اشتراک | `2096` | `2096` |
| `XUI_SUB_PATH` | مسیر URI اشتراک | `/sub/` | `/sub/` |
| `XUI_SUB_DOMAIN` | دامنه اشتراک | - | `sub.example.com` |
| `XUI_SUB_CERT_FILE` | مسیر گواهی SSL برای اشتراک | - | `/app/cert/sub-fullchain.pem` |
| `XUI_SUB_KEY_FILE` | مسیر کلید خصوصی SSL برای اشتراک | - | `/app/cert/sub-privkey.pem` |

**تنظیمات دیتابیس PostgreSQL:**

| متغیر | توضیحات | پیش‌فرض | ضروری | مثال |
| --- | --- | --- | --- | --- |
| `XUI_DB_HOST` | هاست PostgreSQL | `localhost` | خیر | `postgres` |
| `XUI_DB_PORT` | پورت PostgreSQL | `5432` | خیر | `5432` |
| `XUI_DB_USER` | کاربر PostgreSQL | - | **بله** | `xui_user` |
| `XUI_DB_PASSWORD` | رمز عبور PostgreSQL | - | **بله** | `change_this_password` |
| `XUI_DB_NAME` | نام دیتابیس | App name | خیر | `xui_db` |
| `XUI_DB_SSLMODE` | حالت SSL | `disable` | خیر | `disable`, `require`, `verify-ca`, `verify-full` |

**لاگ‌گیری و دیباگ:**

| متغیر | توضیحات | پیش‌فرض | مثال |
| --- | --- | --- | --- |
| `XUI_LOG_LEVEL` | سطح لاگ‌گیری | `info` | `debug`, `info`, `notice`, `warning`, `error` |
| `XUI_DEBUG` | حالت دیباگ | `false` | `true`, `false` |
| `XUI_LOG_FOLDER` | پوشه لاگ | وابسته به پلتفرم | `/var/log/xui` |

**تنظیمات Xray:**

| متغیر | توضیحات | پیش‌فرض | مثال |
| --- | --- | --- | --- |
| `XRAY_VMESS_AEAD_FORCED` | اجبار VMESS AEAD | `false` | `true`, `false` |

**امنیت:**

| متغیر | توضیحات | پیش‌فرض | مثال |
| --- | --- | --- | --- |
| `XUI_ENABLE_FAIL2BAN` | فعال‌سازی fail2ban | `true` | `true`, `false` |

**تنظیمات TLS سرویس نود:**

| متغیر | توضیحات | پیش‌فرض | مثال |
| --- | --- | --- | --- |
| `NODE_TLS_CERT_FILE` | مسیر گواهی SSL برای API نود | - | `/app/cert/node-cert.pem` |
| `NODE_TLS_KEY_FILE` | مسیر کلید خصوصی SSL برای API نود | - | `/app/cert/node-key.pem` |

**مثال پیکربندی docker-compose.yml:**

```yaml
services:
  3xui:
    environment:
      # Xray settings
      XRAY_VMESS_AEAD_FORCED: "false"
      XUI_ENABLE_FAIL2BAN: "true"
      
      # Web Panel settings (only via env, not available in UI)
      XUI_WEB_PORT: 2053
      XUI_WEB_LISTEN: 0.0.0.0
      XUI_WEB_DOMAIN: panel.example.com
      XUI_WEB_BASE_PATH: /
      XUI_WEB_CERT_FILE: /app/cert/fullchain.pem
      XUI_WEB_KEY_FILE: /app/cert/privkey.pem
      
      # Subscription settings (only via env, not available in UI)
      XUI_SUB_PORT: 2096
      XUI_SUB_PATH: /sub/
      XUI_SUB_DOMAIN: sub.example.com
      XUI_SUB_CERT_FILE: /app/cert/sub-fullchain.pem
      XUI_SUB_KEY_FILE: /app/cert/sub-privkey.pem
      
      # PostgreSQL settings
      XUI_DB_HOST: postgres
      XUI_DB_PORT: 5432
      XUI_DB_USER: xui_user
      XUI_DB_PASSWORD: change_this_password
      XUI_DB_NAME: xui_db
      XUI_DB_SSLMODE: disable
```

**نکات مهم:**

* تنظیمات پنل وب و اشتراک (`XUI_WEB_*` و `XUI_SUB_*`) **فقط از طریق متغیرهای محیطی در دسترس هستند** و نمی‌توانند از طریق رابط کاربری وب تغییر کنند.
* اعتبارنامه‌های دیتابیس (`XUI_DB_USER`, `XUI_DB_PASSWORD`) برای کار کردن برنامه **الزامی** هستند.
* تمام مسیرهای گواهی باید مسیرهای مطلق داخل کانتینر باشند (معمولاً `/app/cert/*.pem`).
* دیتابیس روی هاست از طریق bind mount ذخیره می‌شود: `$PWD/postgres_data:/var/lib/postgresql/data`.

#### گواهی‌های SSL و پیکربندی TLS

**راه‌اندازی گواهی:**

1. **دریافت گواهی‌های SSL**
* شما نیاز به یک نام دامنه دارید که به سرور شما اشاره کند.
* گواهی‌های SSL را دریافت کنید (مثلاً از Let's Encrypt یا از CA خودتان استفاده کنید).
* شما نیاز به دو فایل دارید:
* **برای پنل**: فایل گواهی: `cert.pem` (یا `fullchain.pem`).
* **برای نودها** (پیشنهادی): فایل گواهی: `fullchain.pem`.
* فایل کلید خصوصی: `privkey.pem` (برای هر دو پنل و نودها).




2. **قرار دادن گواهی‌ها در دایرکتوری cert/**
```bash
# اطمینان از وجود دایرکتوری cert
mkdir -p cert

# کپی کردن فایل‌های گواهی شما
cp /path/to/certificate.pem cert/cert.pem
cp /path/to/private.key cert/privkey.pem

# تنظیم مجوزهای مناسب
chmod 644 cert/cert.pem
chmod 600 cert/privkey.pem
```


3. **پیکربندی در پنل**
* نام دامنه: دامنه شما (مثلاً `panel.example.com`).
* مسیر گواهی: `/app/cert/cert.pem`.
* مسیر کلید خصوصی: `/app/cert/privkey.pem`.



**برای نودها:**

* **فرمت گواهی پیشنهادی**: برای نودها از `fullchain.pem` استفاده کنید.
* فایل گواهی: `fullchain.pem`.
* فایل کلید خصوصی: `privkey.pem`.
* این فایل‌ها باید در دایرکتوری `node/cert/` قرار گیرند.
* متغیرهای محیطی در `docker-compose.yml` نود:
* `NODE_TLS_CERT_FILE=/app/cert/fullchain.pem`
* `NODE_TLS_KEY_FILE=/app/cert/privkey.pem`



**نگاشت مسیر گواهی:**

* مسیر هاست: `./cert/` (نسبت به docker-compose.yml).
* مانت کانتینر: `/root/cert/` (همانطور که در volumes تعریف شده).
* مسیرهای پنل: `/app/cert/` (استفاده شده در تنظیمات پنل).

**تایید TLS:**

* پس از پیکربندی، از طریق `https://your-domain.com:2053` دسترسی پیدا کنید.
* مرورگر باید گواهی SSL معتبر را نشان دهد.
* انقضای گواهی را بررسی کرده و در صورت نیاز تمدید کنید.

### مهاجرت از SQLite

اگر در حال مهاجرت از نسخه قدیمی‌تری هستید که از SQLite استفاده می‌کند (نسخه ۲.۸.۵ و بالاتر):

1. **خروجی گرفتن از داده‌های پنل قدیمی**
* از پیکربندی خود در پنل قدیمی خروجی بگیرید (نسخه ۲.۸.۵ یا بالاتر).
* فایل پشتیبان (Backup) را در جای امنی ذخیره کنید.
* این فایل پشتیبان برای مهاجرت استفاده خواهد شد.


2. **شروع پنل جدید**
* مراحل نصب بالا را برای راه‌اندازی پنل جدید دنبال کنید.
* به رابط وب پنل جدید دسترسی پیدا کنید.
* در صورت نیاز راه‌اندازی اولیه را تکمیل کنید.


3. **مهم: هشدار پیکربندی دامنه**
**⚠️ حیاتی**: اگر پنل قدیمی شما نام دامنه متفاوتی داشته است، در حین مهاجرت تنظیمات دامنه در پنل جدید را بازنویسی خواهد کرد.
**قبل از وارد کردن (Import)**، اگر نیاز دارید تنظیمات دامنه پنل جدید را حفظ کنید:
* به دیتابیس PostgreSQL متصل شوید.
* تنظیمات دامنه را از داده‌های پنل قدیمی در دیتابیس پاک کنید.
* این کار از بازنویسی پیکربندی دامنه پنل جدید توسط دامنه قدیمی جلوگیری می‌کند.


**نکته**: اعتبارنامه‌های ورود شما (نام کاربری و رمز عبور) پس از مهاجرت بدون تغییر باقی می‌مانند.
4. **وارد کردن داده‌های شما**
* به منوی **Settings** در پنل جدید بروید.
* گزینه مهاجرت/وارد کردن (migration/import) را پیدا کنید.
* فایل پشتیبان را از پنل قدیمی خود (نسخه +2.8.5) آپلود کنید.
* فرآیند مهاجرت به طور خودکار انجام می‌شود.
* بررسی کنید که تمام داده‌ها به درستی منتقل شده باشند.
* بررسی کنید که تنظیمات دامنه شما صحیح باشد (اگر آنها را از داده‌های قدیمی پاک نکرده بودید).



### عیب‌یابی (Troubleshooting)

#### بررسی وضعیت کانتینر

```bash
docker-compose ps
```

#### مشاهده لاگ‌ها

```bash
docker-compose logs -f
```

#### ریستارت سرویس‌ها

```bash
docker-compose restart
```

#### توقف سرویس‌ها

```bash
docker-compose down
```

#### حذف تمام داده‌ها (⚠️ هشدار: این کار تمام داده‌ها را حذف خواهد کرد)

```bash
docker-compose down -v
```

### مستندات API

برای ادغام با پنل SharX به صورت برنامه‌نویسی، مرجع کامل API را ببینید:

* **[مستندات API](https://www.google.com/search?q=docs/API.md)** - اندپوینت‌های REST API، احراز هویت، مثال‌ها

### پشتیبانی

برای مشکلات، سوالات یا مشارکت‌ها، لطفاً به مخزن پروژه مراجعه کنید.

---

**نکته**: این نسخه از کانتینرهای داکر برای استقرار و مدیریت آسان استفاده می‌کند. تمام ایمیج‌ها از پیش ساخته شده و آماده استفاده هستند و نیازی به کامپایل یا مراحل نصب پیچیده را از بین می‌برند.
